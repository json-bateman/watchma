# Lefthook configuration for Watchma
# Docs: https://github.com/evilmartians/lefthook

pre-commit:
  commands:
    go-fmt:
      glob: "*.go"
      run: go fmt ./...

pre-push:
  commands:
    go-build:
      run: |
        echo "Building Go application..."
        templ generate && tailwindcss -i web/input.css -o public/styles.css && go build -o ./tmp/main ./cmd/main.go 
      fail_text: |
        Go build failed!
        Fix build errors before pushing.

    # Run quick smoke tests on feature branches (NOT on main)
    smoke-tests:
      interactive: true
      run: |
        echo "Running smoke tests (auth + rooms)..."
        npx playwright test auth.spec.ts rooms.spec.ts --workers=1
      skip:
        - ref: main
      fail_text: |
        Smoke tests failed!
        Run 'npm test' locally to debug.
        Use 'git push --no-verify' to skip (not recommended).

    # Run full test suite when pushing to main
    full-tests:
      interactive: true
      run: |
        echo "Running FULL test suite..."
        npx playwright test --workers=1
      only:
        - ref: main
      fail_text: |
        Full test suite failed!
        Fix all test failures before pushing to main.
        Use 'git push --no-verify' to skip (not recommended).

